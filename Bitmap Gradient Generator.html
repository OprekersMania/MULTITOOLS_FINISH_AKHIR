<html>
<head>
  <title>Test Demo</title>
		<link rel="stylesheet" href="semantic.min.css">
    <!-- <link href="index.min.css" rel="stylesheet"> -->
		<script src="index.min.js"></script>
		<script src="jquery-3.2.1.min.js"></script>
		<script src="semantic.min.js"></script>
		<script src="jscolor.js"></script>

<style>

	html, body {
		margin: 0 10px;
		scroll-behavior: smooth;
	}
	
	h4 {
		margin:0;
	}
	

	textarea {
		font-family: "Courier", monotype;
		font-size: 0.9em !important;
		width:500px;
		height:200px;
		overflow-wrap: normal;
	}

    .color {
		position:relative;
		width:95%;
		height:20px;
    }
	
	
	.ui.form input[type=number]{
	width: 60px;
    height: 20px;
	padding: 0px 0px 0px 5px;
	}
	
	.ui.form input[type=text]{
	width: 80px;
    height: 20px;
	padding: 0px 0px 0px 5px;
	}
	
	
</style>
<script>
	// Here we can adjust defaults for all color pickers on page:
	jscolor.presets.default = {
		palette: [
			'#000000', '#7d7d7d', '#870014', '#ff0000', '#ff7e26', '#ffff00', '#00ff00', '#00ffff', '#0000ff', '#a349a4',
			'#ffffff', '#c3c3c3', '#b87957', '#feaec9', '#ffc80d', '#eee3af', '#b5e61d', '#99d9ea', '#7092be', '#c8bfe7',
		],
	}
	jscolor.trigger('input change');
</script>

</head>
<!-------------------------------->
<body>
<!-------------------------------->
	<div style="background-color: #37f21c54; margin-top: 15px;" class="ui red segment">
			<h2 align="center" style="font-size: 30px;">Generator Gradasi warna + BMP Array splitter untuk library lcd TFT</h2>
	</div>
	<p align="center" style="padding-top: 5px;padding-bottom: 5px;">
		
			<b>Tata letak dan modifikasi fitur, di desain oleh member facebook,  
				<a href="https://www.facebook.com/profile.php?id=100015443235767" target="_blank">DONY OPREKERS</a>. <br>Sumber original karya <a href="https://www.thingiverse.com/jamesvilleneuve/designs" target="_blank">james villeneuve</a> di link asli <a href="https://www.thingiverse.com/thing:3017556" target="_blank">disini.</a>
			</b> <br>
	</p>
<!-------------------------------->
	
<div class="ui red inverted segment">
  <div class="ui blue inverted segment">
	<div class="ui form">
	
		<div class="two fields">
				<div class="field">
					<label><font color="white">Data BMP yang akan di Split</font></label>
					<textarea id="source" style="font-weight: bolder; height:230px">
const uint8_t kal [] PROGMEM ={
0x38, 0x00, 0x00, 0x00, 0x00,
0x7e, 0x00, 0x3e, 0x00, 0x00,
0xe6, 0x00, 0x3e, 0x00, 0x00,
0xe7, 0x80, 0x3f, 0x00, 0x00,
0x7f, 0xe1, 0xff, 0xe1, 0x80,
0x1f, 0xe3, 0xff, 0xf3, 0xc0,
0x0f, 0xfb, 0xff, 0xff, 0xe0,
0x03, 0xfc, 0xff, 0xff, 0xf0,
0x03, 0xfe, 0x7f, 0xff, 0xe0,
0x00, 0xfe, 0x00, 0x3f, 0xe0,
0x00, 0x7f, 0x80, 0x1f, 0xe0,
0x00, 0x3f, 0xc0, 0x07, 0xe0,
0x03, 0x9f, 0xee, 0x03, 0xe0,
0x03, 0xe7, 0xff, 0xe3, 0xf0,
0x3f, 0xe3, 0xff, 0xe1, 0xfe,
0x3f, 0xe1, 0xff, 0xf1, 0xff,
0x3f, 0xe1, 0xf8, 0x71, 0xff,
0x3f, 0xe1, 0xf0, 0x71, 0xff,
0x3f, 0xe1, 0xe0, 0x31, 0xff,
0x0f, 0xe1, 0xf0, 0x13, 0xfc,
0x03, 0xe0, 0xf8, 0x03, 0xf0,
0x03, 0xf0, 0x3c, 0x03, 0xe0,
0x03, 0xfc, 0x1e, 0x0f, 0xe0,
0x01, 0xfe, 0x00, 0x1f, 0xc0,
0x03, 0xff, 0xc1, 0xff, 0xe0,
0x03, 0xff, 0xff, 0xff, 0xf0,
0x03, 0xff, 0xff, 0xff, 0xf0,
0x01, 0xef, 0xff, 0xfb, 0xe0,
0x00, 0xe3, 0xff, 0xe1, 0xc0,
0x00, 0x00, 0x3f, 0x00, 0x00,
0x00, 0x00, 0x3f, 0x00, 0x00,
0x00, 0x00, 0x3e, 0x00, 0x00
};
								</textarea>
					<br>
					<br>
					<label for="BukaFile" class="ui inverted blue button left floated" style="background-color:0;"> Buka File BMP (*.h)</label>
					<input id="BukaFile" type="file" style="display:none;" > 
					
					<label for="hapus" class="ui inverted red button left floated" style="background-color:0;"> Hapus area teks</label>
					<input id="hapus" style="display:none;" onclick="hapus()"> 
					
					
			<!--		<button class="ui inverted red button right floated" onclick="Split()" style="background-color:#0ff">Ekstrak</button> -->

					<br>
					<br>
					Pada akhir nama akan ditambah angka otomatis dari 0 sampai maks jumlah hasil warna gradasi
					<font color="black"><b>Nilai gradasi yg ditampilkan adalah hasil tinggi gambar dibagi nilai pembagi baris gambar</b></font> 
					<br> 
					Jumlah warna gradasi yang dihasilkan  &nbsp;&emsp;&emsp; <input type="number" id="range" value="" /> 
					
					
				</div>

				<div class="field">
				
				Pilih Base warna Gradasi <br>
<input type="radio" name="BaseWarna" onchange="handleChange1();" value="3" checked/> 3 warna &emsp; 
<input type="radio" name="BaseWarna" onchange="handleChange2();" value="4" /> 4 warna &emsp; 
<input type="radio" name="BaseWarna" onchange="handleChange3();" value="5" /> 5 warna &emsp; 
<input type="radio" name="BaseWarna" onchange="handleChange4();" value="6" /> 6 warna 
<hr>

				
				
				
					<div class="six fields">
						<div class="field">
							<label style="text-align:center" > Warna 1 </label>
							<input type="text" id="color1" name="color1" value="FF00FF" />
							<button class="color" data-jscolor="{valueElement:'#color1'}"></button>
						</div>
						<div class="field">
							<label style="text-align:center" > Warna 2 </label>
							<input type="text"  id="color2" name="color2" value="000fff" />
							<button class="color" data-jscolor="{valueElement:'#color2'}"></button>
						</div>
						<div class="field">
							<label style="text-align:center" > Warna 3 </label>
							<input type="text"  id="color3" name="color3" value="00ff0f" />
							<button class="color" data-jscolor="{valueElement:'#color3'}"></button>
						</div>
						<div class="field" id="Warna4" style="display: none;">
							<label style="text-align:center" > Warna 4 </label>
							<input type="text" id="color4" name="color4" value="FFFF00" />
							<button class="color" data-jscolor="{valueElement:'#color4'}"></button>
						</div>
						<div class="field" id="Warna5" style="display: none;">
							<label style="text-align:center" > Warna 5 </label>
							<input type="text" id="color5" name="color5" value="FfA544" />
							<button class="color" data-jscolor="{valueElement:'#color5'}"></button>
						</div>
						<div class="field"  id="Warna6" style="display: none;">
							<label style="text-align:center" > Warna 6 </label>
							<input type="text" id="color6" name="color6" value="ff0000" />
							<button class="color" data-jscolor="{valueElement:'#color6'}"></button>
						</div>
					</div>
					Klik pada kotak warna untuk merubah warna.
					<hr>

					<h4>Parameter dibawah ini untuk pembuatan fungsi pembuatan gradasi,<br>
					dan fungsi pemanggilan tft.DrawBitmap (Gambar BMP Dibagi Jumlah pembagi gradasi)</h4><br>
					
					Nama BMP baru &emsp;<input id="NamaFILE" value="" style="width:100px; height:20px"> &emsp; <font color="black"><b>*Opsional</b></font>
					<br><br>
					Dimensi Gambar BMP  &emsp; : &emsp; Panjang <input type="number" id="bmpP"  value="40" min="10" max="160"/> px &emsp;&emsp;
														Tinggi  <input type="number" id="bmpT" value="32" min="10" max="160"/> px  
														&emsp; <font color="black"><b>*wajib</b></font> <br><br>
					Set titik kursor awal &emsp; : &emsp; Cursor_X <input type="number" id="CurX" value="0" min="0" max="160"/> &emsp;&emsp; 
														  Cursor_Y <input type="number" id="CurY" value="0" min="0" max="160"/> 
														  &emsp; <font color="black"><b>*wajib</b></font> <br>
					<hr>
					Jumlah Pembagi baris gambar &emsp; <input type="number" id="Bagian" value="2" min="1" max="100"/> &emsp; <font color="black"><b>*wajib</b></font> 
		
				</div>

		</div>
		
	 </div>
	 
  </div>
	<div class="ui form">
		<div class="fields" >
					<button id="proses" class="ui inverted black button right floated" onclick="jadiin()" style="background-color:#0f0"> Buat Gradasi dan ekstrak gambar </button>
					&emsp; Klik beberapa kali agar warna gradasi hasil lebih maksimal 
					<br>&emsp; (BUG, barangkali ada yg bisa bantu fix.)
	</div>
	</div>
</div>
<!-------------------------------->

 <div id="hasilnya" style="display:none;">
 
	<canvas id="myCanvas" width="1030" height="190" style="border:1px solid #d3d3d3;">
	Jika kamu melihat tulisan ini, Berarti browsermu tidak suport HTML5 canvas tag.</canvas>

	<h3>Hasil kode akhir untuk fungsi gradasi warna</h3>
	<div class="eight wide column" >
      <div class="ui secondary inverted segment" id="resultWrapper">
        <div class="ui form">
          <div class="two fields">
			  <div class="field">
					<label><font color="white">Fungsi pemangil tft.drawBitmap</font></label>
					<textarea id="colorSets2" readonly="" cols='100' rows='320' style="font-weight: bolder;"> Belum ada</textarea>
					<br>
					<br>
					<button class="ui inverted teal button" id="copying">Salin ke clipboard</button>
			  </div>
			  <div class="field">
					<label><font color="white">Data BMP Split array</font></label>
					<textarea id="result" readonly="" cols='100' rows='20' style="font-weight: bolder;"></textarea>
					<br>
					<br>
					<button class="ui inverted teal button" id="copying2">Salin ke clipboard</button>
			  </div>
          </div>
		  
        </div>
      </div>
    </div>
   </div>
					<br>
					<br>
					<br>
	<div align="center">
		<h3>------------- &emsp;    Dony Oprekers 2021  &emsp;  --------------</h1>
					<br>
	</div>
 

</body>
<script>
<!-------------------------------->


document.getElementById('BukaFile')
  .addEventListener('change', getFile)
  
function hapus() {
	$('#source').val('');
}

function getFile(event) {
	const input = event.target
  if ('files' in input && input.files.length > 0) {
	  placeFileContent(
      document.getElementById('source'),
      input.files[0])
  }    
}

function readFileContent(file) {
	const reader = new FileReader()
  return new Promise((resolve, reject) => {
    reader.onload = event => resolve(event.target.result)
    reader.onerror = error => reject(error)
    reader.readAsText(file)
  })
}

function placeFileContent(target, file) {
	readFileContent(file).then(content => {
  	target.value = content
  }).catch(error => console.log(error))
}


function heatMapColorforValue(value){
	var h = (1.0 - value) * 240
	return "hsl(" + h + ", 100%, 50%)";
}

function rgbToHex(r, g, b) {
    if (r > 255 || g > 255 || b > 255)
        throw "Invalid color component";
    return ((r << 16) | (g << 8) | b).toString(16);
}

function copy()
{
	var imgData=ctx.getImageData(10,10,50,50);
	ctx.putImageData(imgData,10,70);
}

function decimalToHex(d, padding) {
    var hex = Number(d).toString(16);
    padding = typeof (padding) === "undefined" || padding === null ? padding = 2 : padding;

    while (hex.length < padding) {
        hex = "0" + hex;
    }

    return hex;
}


var name;
var gagal;
var newname = "";
	
function Split() {
		let Newdata = 0;
		var bagi = document.getElementById("Bagian").value;
		let data = document.getElementById("source").value;
		newname = document.getElementById('NamaFILE').value;
		
	  re = /(.*)(const)/;
	  const found = data.match(re);
	  
	  if (found != null && found.length > 1) {
		//alert('Ditemukan text yang tidak diperlukan sebelum aray file.\nSemua text dibelakang kata "const uint8_t...." akan dihapus dulu.');
		
		// hapus semua text sebelum kata tertentu
		Newdata = data.substring(data.indexOf("const"));
		// hapus semua text dan ganti setelah kata tertentu
		//Newdata = Newdata.replace(/\n};.*/," \n};");
		$('#source').val(Newdata);
		
	  } else {
		Newdata = data;
	  }
		
	  re = /const unsigned\schar|uint8_t\ (.*) \[\]/;
	  const nfound = Newdata.match(re);
	  
	  if (nfound != null && nfound.length > 1) {
		  name = nfound[1];
		  if(!newname){
			newname = name;
			document.getElementById('NamaFILE').value = name;
		  }
	  } else {
		alert('Tidak ditemukan kode BMP image yang benar, silakan buka file, atau tempelkan kode array BMP terlebih dahulu.\n\nPastikan format nama array BMP seperti dibawah ini:\n\nconst uint8_t NAMA [ ] PROGMEM ...\n\nDan TIDAK ada kode / teks apapun sebelum/diatas "const uint8_t namafile.....');
		return 0;
	  }

		var lines = Newdata.trim().split(/\n/).slice(0, -1);
		let ii = 0, prefix = lines.splice(0, 1)[0], result = [];
		let groups = lines.reduce((b, a, i) => {
		if (i % bagi === 0) {
		  b.push([a]);
		  ii++
		} else b[ii].push(a);
			return b;
		}, [[]]).filter(a => a.length > 0);

		groups.forEach((g,i) => {
			g.unshift(prefix.replace(name, newname + `_${i}`))
			g[g.length-1] = g[g.length-1].slice(0,-1)
			gagal = i;
			g.push("};");
			result.push(g.join("\n"))
		})

		document.getElementById("result").value = result.join("\n");
		return 1;
}

var pilihanwarna = 3;

function jadiin(){
	let tes = Split();
	if(tes){
		$('#hasilnya').show()
		 $('html, body').animate({
			scrollTop: $("#hasilnya").offset().top-100
		},1000);
	} else {
		$('#hasilnya').hide()
	}
	var startatcolorintable;
	var c = document.getElementById("myCanvas");
	var ctx = c.getContext("2d");
	var hexinfo="000000";

	// var pilihanwarna = document.getElementById('base').value;
		
	//we copy old color data into place
	if (pilihanwarna == 3 || pilihanwarna == 4 || pilihanwarna == 5 || pilihanwarna == 6){
	var color1=document.getElementById('color1').value;
	var color2=document.getElementById('color2').value;
	var color3=document.getElementById('color3').value;
	}
	if (pilihanwarna == 4 || pilihanwarna == 5 || pilihanwarna == 6) { 
	var color4=document.getElementById('color4').value;
	}
	if (pilihanwarna == 5 || pilihanwarna == 6) { 
	var color5=document.getElementById('color5').value;
	}
	if (pilihanwarna == 6) { 
	var color6=document.getElementById('color6').value;
	}

	var across = 6;
	var repeat= 1; 
	//var range =document.getElementById('range').value;
	var startsamplingat=1;
	//we get old color table values to compare color data
	var dataOldColor= new Array(1024);//we get old color data of 256 words of color information


	// Create gradient
	var grd = ctx.createLinearGradient(0,0,1520,0);
	//we show gradience of 6 colors 1/6=

		if (pilihanwarna == 3) { 
			grd.addColorStop(0,color1);//0.1666
			grd.addColorStop(0.3333*1,color2);
			grd.addColorStop(0.3333*2,color3);
		} else if (pilihanwarna == 4) { 
			grd = ctx.createLinearGradient(0,0,1340,0);
			grd.addColorStop(0,color1);//0.1666
			grd.addColorStop(0.25*1,color2);
			grd.addColorStop(0.25*2,color3);
			grd.addColorStop(0.25*3,color4);
		} else if (pilihanwarna == 5) { 
			grd = ctx.createLinearGradient(0,0,1255,0);
			grd.addColorStop(0,color1);//0.1666
			grd.addColorStop(0.2*1,color2);
			grd.addColorStop(0.2*2,color3);
			grd.addColorStop(0.2*3,color4);
			grd.addColorStop(0.2*4,color5);
		} else if (pilihanwarna == 6) { 
			grd = ctx.createLinearGradient(0,0,1210,0);
			grd.addColorStop(0,color1);//0.1666
			grd.addColorStop(0.1666*1,color2);
			grd.addColorStop(0.1666*2,color3);
			grd.addColorStop(0.1666*3,color4);
			grd.addColorStop(0.1666*4,color5);
			grd.addColorStop(0.1666*5,color6);
		}
	// Fill with gradient


	ctx.fillStyle = grd;
	ctx.fillRect(0,10,1600,50);
	ctx.beginPath();
	ctx.font="15px Arial Black";
	ctx.fillStyle = '#000000';
	ctx.fillText("[Contoh Gradasi 24bit RGB]",300,40);
	ctx.fillStyle = grd;
	//data=0;
	var imgData = ctx.getImageData(0, 0, 1024, 210);
	 //var imgData=ctx.getImageData(1, 1, 1024, 100).data  
	 //'rgb(0,'+Math.floor(i)+','+Math.floor(i)+')';
	 var red,green,blue;
	var space =" ";
	var temp=0;

	// Penambahan pemanggilan fungsi tft.drawbmp pada tap baris hasil warna.

	var namaBMP=newname;
	var bmp_P=document.getElementById('bmpP').value;
	var bmp_T= document.getElementById('bmpT').value;
	var cur_X=document.getElementById('CurX').value;
	var CurY = document.getElementById('CurY').value;

	var Bagian = document.getElementById('Bagian').value;

	var awaltft = 'tft.drawBitmap(' + cur_X + ', ';
	var tengahtft = ', ' + namaBMP + '_';
	var akhirtft = ', ' + bmp_P + ', ' + Bagian + ', 0x';

	var range = gagal;
	//var range = Math.round(bmp_T / Bagian);
	document.getElementById('range').value= range;

	// THIS FUNCTION FOR GENERATE RESULT HEX COLOR DATA
	document.getElementById('colorSets2').innerHTML="\n ";//start for data .toString(16) makes data hex
	for (  i=0;i<=range;i++){
	  for (  j=0;j<1024/range;j++){
	  
	 //if (temp>Math.round1024/ range){temp=0;}
	  ctx.beginPath();

	var imgData = ctx.getImageData(i*(1024/range)+j+Math.floor(startsamplingat), 10,2, 2);
	 
	if (j==0){

	red = imgData.data[0];
	green = imgData.data[1];
	blue = imgData.data[2];
	}
	ctx.moveTo(i*(1024/range)+j, 130);
	ctx.lineTo(i*(1024/range)+j, 180);

	ctx.strokeStyle ='rgb('+Math.floor(red&248)+','+Math.floor(green&252)+','+Math.floor(blue&248)+')';
	//ctx.strokeStyle ='rgb(0,0,255)';

	//'rgb('+Math.floor(red/16)+','+Math.floor(green/8)+','+Math.floor(blue/16)+') ';

	//getPixelXY(temp,i,50)



	ctx.stroke();
	}
	var temprepeat=repeat;//if we are repeating data we have this to do it
	while (temprepeat>0){ temprepeat--;

	if (CurY<10){ CurY = ' ' + CurY;}
	if (i<10){ i = i + ' ';}

	//document.getElementById('colorSets2').innerHTML+='rgb('+Math.floor(red&248)+','+Math.floor(green&252)+','+Math.floor(blue&248)+')';
	hexinfo= awaltft + CurY + tengahtft + i + akhirtft + (Math.floor(red/8)*2048+Math.floor(green/4)*32+Math.floor(blue/8)).toString(16) + ');\n ';

	while (hexinfo.length<5){hexinfo='0'+hexinfo;} //this adds leading zeros
	document.getElementById('colorSets2').innerHTML+= hexinfo;
	temp++;
	}

	CurY = Math.floor(CurY)+Math.floor(Bagian);

	if (temp>across){temp=0;} //we ad a return to make things go to next line to be nice

	}

	//this is at end of loop, all values in table text area, 
	// now we need to clean up last comment and close loop 
	var temptable=document.getElementById('colorSets2').innerHTML
	document.getElementById('colorSets2').innerHTML=temptable.substring(0,temptable.length-1);//we remove last coma
	//document.getElementById('colorSets2').innerHTML+=" \n};";//we want number to stay after refresh;//start for data .toString(16) makes data hex
	//this part simulates actual chart data

	for (  i=0;i<64;i++){
	 for (j=0;j<16;j++){
	  
	 //if (temp>Math.round1024/ range){temp=0;}
	  ctx.beginPath();

	var imgData = ctx.getImageData(i*16+Math.floor(startsamplingat), 10,2, 2);
	 

	if (j==0){
	red = imgData.data[0];
	green = imgData.data[1];
	blue = imgData.data[2];
	}

		// this is 64 color reference bar image
	ctx.moveTo(i*16+j, 70);
	ctx.lineTo(i*16+j, 120);

	 
	ctx.strokeStyle ='rgb('+Math.floor(red&248)+','+Math.floor(green&252)+','+Math.floor(blue&248)+')';
	//getPixelXY(temp,i,50)

	ctx.stroke();
	}
	}
	//copy();
	ctx.beginPath();
	ctx.font="15px Arial Black";
	ctx.fillStyle = '#000000';
	ctx.fillText("[Contoh gradasi 64 warna.]",300,102);
	ctx.fillText("[ " + range + " warna hasil akhir]",300,163);
	ctx.stroke();

}

  
$(document).ready(function () {
    $('input:radio[name="BaseWarna"]').change(function() {
        if ($(this).val() == '3') {
			pilihanwarna = 3;
			$('#Warna4').hide()
			$('#Warna5').hide()
			$('#Warna6').hide()
        } else if ($(this).val() == '4') {
			pilihanwarna = 4;
			$('#Warna4').show()
			$('#Warna5').hide()
			$('#Warna6').hide()
        } else if ($(this).val() == '5') {
			pilihanwarna = 5;
			$('#Warna4').show()
			$('#Warna5').show()
			$('#Warna6').hide()
        } else if ($(this).val() == '6') {
			pilihanwarna = 6;
			$('#Warna4').show()
			$('#Warna5').show()
			$('#Warna6').show()
        }
	document.getElementById("testing").value = pilihanwarna
    });
<!---------------------------------------------------->
<!------        FUNGSI copy to clipboard        ------>
<!---------------------------------------------------->
  $('#copying').click(function () {
  
	  var copyText = document.getElementById("colorSets2");
	  copyText.select();
	  copyText.setSelectionRange(0, 9999999); /*Change higher if all content not copied*/
	  document.execCommand("copy");
  });
<!---------------------------------------------------->
<!------        FUNGSI copy to clipboard        ------>
<!---------------------------------------------------->
  $('#copying2').click(function () {
  
	  var copyText = document.getElementById("result");
	  copyText.select();
	  copyText.setSelectionRange(0, 9999999); /*Change higher if all content not copied*/
	  document.execCommand("copy");
  });


});


</script>
</html>
